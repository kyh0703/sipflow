---
phase: 05-ui-completion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/main.tsx
  - frontend/src/components/ui/theme-toggle.tsx
  - frontend/src/features/scenario-builder/components/scenario-builder.tsx
autonomous: true

must_haves:
  truths:
    - "앱이 System 기본 테마로 시작되며 OS 다크모드 시 어두운 UI가 표시된다"
    - "헤더 우측 테마 토글 버튼으로 Light/Dark/System 순환 전환된다"
    - "테마 선택이 localStorage에 저장되어 새로고침 후에도 유지된다"
    - "다크모드에서 모든 shadcn/ui 컴포넌트, 캔버스, 패널이 정상 렌더링된다"
  artifacts:
    - path: "frontend/src/main.tsx"
      provides: "ThemeProvider 래핑 설정"
      contains: "ThemeProvider"
    - path: "frontend/src/components/ui/theme-toggle.tsx"
      provides: "3-way 테마 토글 컴포넌트"
      exports: ["ThemeToggle"]
    - path: "frontend/src/features/scenario-builder/components/scenario-builder.tsx"
      provides: "헤더에 ThemeToggle 배치"
      contains: "ThemeToggle"
  key_links:
    - from: "frontend/src/main.tsx"
      to: "next-themes ThemeProvider"
      via: "attribute='class' + defaultTheme='system'"
      pattern: "ThemeProvider.*attribute.*class"
    - from: "frontend/src/components/ui/theme-toggle.tsx"
      to: "next-themes useTheme hook"
      via: "useTheme() 호출로 theme/setTheme 획득"
      pattern: "useTheme"
    - from: "frontend/src/features/scenario-builder/components/scenario-builder.tsx"
      to: "frontend/src/components/ui/theme-toggle.tsx"
      via: "헤더 우측에 ThemeToggle 임포트 및 배치"
      pattern: "ThemeToggle"
---

<objective>
next-themes 기반 다크모드를 구현하여 Light/Dark/System 3가지 테마 모드를 지원한다.

Purpose: 프로덕션 품질 UI의 핵심 요소로, 사용자가 OS 설정에 따라 자동으로 적절한 테마를 사용하거나 수동으로 전환할 수 있게 한다.
Output: ThemeProvider 래핑, ThemeToggle 컴포넌트, 헤더 바에 토글 배치 완료.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-completion/CONTEXT.md
@.planning/phases/05-ui-completion/05-RESEARCH.md

@frontend/src/main.tsx
@frontend/src/index.css
@frontend/src/components/ui/sonner.tsx
@frontend/src/features/scenario-builder/components/scenario-builder.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: ThemeProvider 설정 + ThemeToggle 컴포넌트 생성</name>
  <files>
    frontend/src/main.tsx
    frontend/src/components/ui/theme-toggle.tsx
  </files>
  <action>
    1. `frontend/src/main.tsx`에서 `ThemeProvider` (from 'next-themes') 래핑 추가:
       - `<App/>` 을 `<ThemeProvider>` 로 래핑
       - props: `attribute="class"`, `defaultTheme="system"`, `enableSystem`, `disableTransitionOnChange`, `storageKey="sipflow-theme"`
       - `themes={['light', 'dark']}` 설정 (system은 자동 해석)

    2. `frontend/src/components/ui/theme-toggle.tsx` 생성:
       - `useTheme` (from 'next-themes') 훅 사용하여 `theme`, `setTheme` 획득
       - 3-way 순환 토글: light → dark → system → light
       - 아이콘: `Sun` (light), `Moon` (dark), `Monitor` (system) from 'lucide-react'
       - shadcn/ui `Button` 컴포넌트 사용: `variant="ghost"`, `size="icon"`
       - `title` 속성으로 현재 테마 표시
       - `<span className="sr-only">` 으로 접근성 레이블 추가
       - Wails 앱은 SSR이 없으므로 mounted 체크가 선택적이지만, useTheme()의 초기값이 undefined일 수 있으므로 mounted 가드 추가 권장:
         ```tsx
         const [mounted, setMounted] = useState(false)
         useEffect(() => setMounted(true), [])
         if (!mounted) return null
         ```

    주의: Sonner의 `useTheme`가 이미 next-themes에서 임포트 중 (sonner.tsx 참조). ThemeProvider가 래핑되면 Sonner도 자동으로 테마 연동됨.
    주의: CSS transition 없이 즉시 전환 (`disableTransitionOnChange` prop으로 달성).
  </action>
  <verify>
    - `wails dev` 실행 후 앱이 OS 테마에 따라 기본 라이트/다크 적용됨 확인
    - 브라우저 DevTools에서 `<html>` 태그에 `class="dark"` 또는 `class="light"` 확인
    - `localStorage.getItem('sipflow-theme')` 존재 확인
    - `frontend/src/components/ui/theme-toggle.tsx` 파일 존재, `ThemeToggle` export 확인
  </verify>
  <done>
    ThemeProvider가 main.tsx에 래핑되어 앱 전체에 테마 컨텍스트 제공, ThemeToggle 컴포넌트가 Sun/Moon/Monitor 아이콘으로 3-way 순환 토글 지원.
  </done>
</task>

<task type="auto">
  <name>Task 2: 헤더 바에 ThemeToggle 배치 + 다크모드 시각 검증</name>
  <files>
    frontend/src/features/scenario-builder/components/scenario-builder.tsx
  </files>
  <action>
    1. `scenario-builder.tsx`의 헤더 바 우측 영역에 `ThemeToggle` 배치:
       - 현재 헤더 우측: `<ExecutionToolbar />` + Save 버튼
       - ThemeToggle을 Save 버튼 뒤에 추가 (헤더 바 가장 우측)
       - `import { ThemeToggle } from '@/components/ui/theme-toggle'` 추가
       - 기존 `flex items-center gap-3` 구조에 자연스럽게 배치

    2. 다크모드에서 ReactFlow 캔버스 배경색 조정:
       - `canvas.tsx`의 `<Background>` 컴포넌트의 `color` prop이 하드코딩된 `#d1d5db`
       - 다크모드에서도 보이도록 CSS variable 기반 또는 조건부 색상으로 변경 고려
       - 단, 이것은 canvas.tsx 수정이므로 최소한으로: `color` prop을 Tailwind 클래스가 아닌 직접 값이라 `useTheme` 또는 CSS variable로 대응
       - 가장 간단한 방법: Background color를 `"var(--muted-foreground)"` 스타일의 CSS variable로 매핑하거나, `resolvedTheme` 에 따라 조건부 설정

    주의: MiniMap도 다크모드에서 가시성 확인 필요. ReactFlow의 MiniMap은 기본적으로 배경색을 상속하지 않으므로 props로 조정이 필요할 수 있음.
    주의: shadcn/ui 컴포넌트(Button, Input, Select, Badge 등)는 이미 CSS variable 기반이므로 자동 다크모드 지원.
  </action>
  <verify>
    - `wails dev` 실행 후 헤더 우측 끝에 테마 토글 아이콘 버튼 표시
    - 클릭 시 Light → Dark → System 순환 확인
    - 다크모드에서: 배경 어두움, 텍스트 밝음, 사이드바/속성패널 어두움, 캔버스 배경 점 가시성
    - 라이트모드에서: 기존과 동일한 밝은 UI
    - System 모드에서: OS 설정에 따라 자동 전환
    - 페이지 새로고침 후 마지막 선택 테마 유지
  </verify>
  <done>
    헤더 바 우측에 ThemeToggle 배치, 다크모드에서 전체 UI (캔버스, 사이드바, 패널, 노드, 로그) 정상 렌더링, 테마 전환 시 깜빡임 없이 즉시 적용.
  </done>
</task>

</tasks>

<verification>
1. `wails dev` 실행 후 앱 정상 로딩
2. 테마 토글 클릭으로 Light/Dark/System 3가지 모드 순환
3. 다크모드에서 모든 UI 요소 가시성 확인 (텍스트, 아이콘, 경계선, 버튼)
4. localStorage에 'sipflow-theme' 키 저장 확인
5. 앱 새로고침 후 테마 유지 확인
6. Sonner toast가 현재 테마에 맞게 표시 확인
</verification>

<success_criteria>
- ThemeProvider가 main.tsx에서 앱 전체를 래핑
- ThemeToggle 컴포넌트가 헤더 바 우측에 배치
- Light/Dark/System 3가지 테마 전환 가능
- 다크모드에서 모든 패널, 캔버스, 노드, 로그가 정상 렌더링
- 테마 선택이 localStorage에 저장되어 새로고침 후에도 유지
</success_criteria>

<output>
완료 후, `.planning/phases/05-ui-completion/05-01-SUMMARY.md` 생성
</output>
