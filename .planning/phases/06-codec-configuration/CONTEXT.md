# Phase 06 Context: Codec Configuration

> 사용자가 SIP 인스턴스별 코덱을 선택하고 우선순위를 설정하여 SDP 협상에 반영할 수 있다

## 논의된 영역

1. [코덱 선택 UI 인터랙션](#1-코덱-선택-ui-인터랙션)

---

## 1. 코덱 선택 UI 인터랙션

### 결정사항

**UI 패턴:** 드래그 리스트
- Properties 패널에 코덱 드래그 리스트 추가
- 각 코덱 항목에 체크박스로 활성화/비활성화
- 드래그로 코덱 우선순위(SDP m= 라인 순서) 변경
- ROADMAP 성공기준 "드래그로 우선순위 변경" 요구사항에 부합

**캔버스 노드 표시:** 코덱 배지 노출
- SIP Instance 노드 하단에 선택된 코덱을 작은 배지로 표시 (e.g., "PCMU, PCMA")
- 캔버스에서 바로 인스턴스의 코덱 설정 확인 가능
- 기존 Mode 배지(DN/Endpoint), Register 배지와 동일한 시각적 패턴

**기본 코덱 설정:** PCMU + PCMA 모두 선택
- 새 SIP Instance 노드 추가 시 PCMU(우선) + PCMA(차순) 기본 선택
- 가장 보편적인 SIP 코덱 조합으로 협상 실패 확률 최소화
- 사용자가 필요에 따라 비활성화하거나 순서 변경 가능

**코덱 미설정 시 동작:** 기본값 자동 적용 후 실행
- 코덱이 하나도 선택되지 않은 상태로 실행 시 PCMU를 기본으로 자동 적용
- 실행을 차단하지 않고, 안전한 기본값으로 진행
- 기존 v1.0 시나리오(코덱 필드 없음)도 동일하게 PCMU 기본 적용 → 하위 호환성 보장

### 현재 상태 (Phase 6 시작 전)

- SIP Instance Properties 패널: label, mode(DN/Endpoint), dn, register, color 설정 가능
- 코덱 관련 필드가 프론트엔드/백엔드 모두 없음
- diago UA 생성 시 코덱 설정 옵션 미사용 (기본값으로만 동작)
- flow_data는 JSON TEXT로 SQLite 저장 → DB 스키마 변경 없이 필드 추가 가능
- SIP Instance 노드에 Mode 배지, Register 배지 표시 패턴 존재 (코덱 배지 추가 용이)

---

## 논의하지 않은 영역 (Claude 판단)

### 코덱 비호환 피드백

사용자가 이 영역을 선택하지 않았으므로, Claude가 기술적으로 판단합니다:

- **편집 중 실시간 경고 없음:** 코덱 호환성은 실행 시 diago SDP 협상에서 자동 처리
- **실행 시 488 Not Acceptable:** 양측에 공통 코덱이 없으면 diago가 488 응답 반환, 기존 에러 이벤트 파이프라인으로 로그 표시
- **노드 상태 시각화:** 협상 실패 시 해당 노드가 error 상태로 하이라이트 (기존 실행 시각화 패턴 활용)
- **추가 UI 불필요:** 기존 로그 패널 + 노드 상태 시각화로 충분한 피드백 제공

### 기본값 및 하위 호환성

- **v1.0 시나리오 로드:** 코덱 필드 없으면 PCMU + PCMA 기본값 자동 적용
- **저장 시 코덱 필드 포함:** 한번 로드 후 저장하면 코덱 필드가 flow_data JSON에 추가됨
- **마이그레이션 불필요:** JSON 파싱 시 optional 필드로 처리, Go `omitempty` + TypeScript `?` 활용

---

## 미뤄진 아이디어

| 아이디어 | 출처 | 비고 |
|----------|------|------|
| 편집 중 코덱 호환성 실시간 검증 | Phase 06 분석 | 양측 인스턴스 교집합 확인, v1.2 코덱 확장에서 고려 |
| Opus 코덱 지원 | v1.1 요구사항 정의 | CGO 의존성으로 v1.2+로 연기 |
| 코덱별 bitrate/ptime 상세 설정 | Phase 06 분석 | 고급 사용자 기능, 현재 불필요 |
| 코덱 프리셋 (VoIP Standard, Low Bandwidth 등) | Phase 06 분석 | PCMU/PCMA 2개뿐이라 현재 불필요 |

---

## 다음 단계

이 CONTEXT.md를 기반으로:
1. `/prp:plan-phase 6` — Phase 6의 상세 실행 계획(PLAN.md) 생성
