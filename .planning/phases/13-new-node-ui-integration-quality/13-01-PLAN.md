---
phase: 13-new-node-ui-integration-quality
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/features/scenario-builder/types/scenario.ts
  - frontend/src/features/scenario-builder/components/nodes/command-node.tsx
  - frontend/src/features/scenario-builder/components/node-palette.tsx
  - frontend/src/features/scenario-builder/components/properties/command-properties.tsx
  - frontend/src/features/scenario-builder/components/properties/event-properties.tsx
autonomous: false

must_haves:
  truths:
    - "Hold, Retrieve, BlindTransfer가 노드 팔레트의 Commands 섹션에 표시되고 캔버스로 드래그앤드롭 가능하다"
    - "BlindTransfer 노드 선택 시 Properties 패널에 Target User와 Target Host 입력 필드가 표시된다"
    - "Hold/Retrieve 노드 선택 시 Properties 패널에 Command Type 배지와 SIP Instance 선택만 표시된다"
    - "HELD/RETRIEVED/TRANSFERRED 이벤트 노드 선택 시 Timeout 입력 필드가 표시된다"
    - "캔버스에 배치된 BlindTransfer 노드에 targetUser@targetHost 정보가 인라인 표시된다"
    - "TypeScript 컴파일 에러 없이 빌드가 성공한다"
  artifacts:
    - path: "frontend/src/features/scenario-builder/types/scenario.ts"
      provides: "Hold, Retrieve, BlindTransfer 타입 정의 + targetUser/targetHost 필드"
      contains: "'Hold', 'Retrieve', 'BlindTransfer'"
    - path: "frontend/src/features/scenario-builder/components/nodes/command-node.tsx"
      provides: "Hold(Pause), Retrieve(Play), BlindTransfer(ArrowRightLeft) 아이콘 + 인라인 표시"
      contains: "Hold: Pause"
    - path: "frontend/src/features/scenario-builder/components/node-palette.tsx"
      provides: "command-Hold, command-Retrieve, command-BlindTransfer 팔레트 항목"
      contains: "command-Hold"
    - path: "frontend/src/features/scenario-builder/components/properties/command-properties.tsx"
      provides: "BlindTransfer targetUser/targetHost 입력 필드"
      contains: "BlindTransfer"
    - path: "frontend/src/features/scenario-builder/components/properties/event-properties.tsx"
      provides: "HELD/RETRIEVED/TRANSFERRED 타임아웃 입력 필드"
      contains: "HELD"
  key_links:
    - from: "scenario.ts COMMAND_TYPES"
      to: "command-node.tsx COMMAND_ICONS"
      via: "타입 유니온 일치"
      pattern: "Hold.*Pause"
    - from: "node-palette.tsx command-Hold"
      to: "canvas.tsx onDrop"
      via: "dataTransfer type 문자열 파싱"
      pattern: "command-Hold"
    - from: "command-properties.tsx BlindTransfer 분기"
      to: "scenario.ts CommandNodeData targetUser/targetHost"
      via: "onUpdate 콜백"
      pattern: "targetUser|targetHost"
---

<objective>
6개 새 노드(Hold, Retrieve, BlindTransfer, TransferEvent, HeldEvent, RetrievedEvent)의 프론트엔드 UI를 완성한다.
Phase 10/11에서 백엔드가 완성되었고, Phase 12에서 UI 레이아웃이 완성되었으나, 프론트엔드 타입/아이콘/팔레트/Properties가 누락된 상태를 해소한다.

Purpose: UI-03 요구사항 충족 (새 노드의 Properties 패널, 아이콘, 팔레트 항목) + NF-03 (기존 DnD 패턴 일관성)
Output: 6개 새 노드가 팔레트에서 드래그앤드롭 가능하고, Properties 패널이 완전하며, 캔버스에서 올바르게 렌더링됨
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-new-node-ui-integration-quality/13-RESEARCH.md
@frontend/src/features/scenario-builder/types/scenario.ts
@frontend/src/features/scenario-builder/components/nodes/command-node.tsx
@frontend/src/features/scenario-builder/components/node-palette.tsx
@frontend/src/features/scenario-builder/components/properties/command-properties.tsx
@frontend/src/features/scenario-builder/components/properties/event-properties.tsx
@frontend/src/features/scenario-builder/components/nodes/event-node.tsx
@frontend/src/features/scenario-builder/components/canvas.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: TypeScript 타입 + Command 노드 아이콘 + 팔레트 + Properties 완성</name>
  <files>
    frontend/src/features/scenario-builder/types/scenario.ts
    frontend/src/features/scenario-builder/components/nodes/command-node.tsx
    frontend/src/features/scenario-builder/components/node-palette.tsx
    frontend/src/features/scenario-builder/components/properties/command-properties.tsx
    frontend/src/features/scenario-builder/components/properties/event-properties.tsx
  </files>
  <action>
    **1. scenario.ts 타입 업데이트:**
    - `COMMAND_TYPES` 배열에 `'Hold'`, `'Retrieve'`, `'BlindTransfer'` 추가
    - `CommandNodeData` 인터페이스에 `targetUser?: string`, `targetHost?: string` 필드 추가 (BlindTransfer용)

    **2. command-node.tsx 아이콘 + 인라인 표시:**
    - lucide-react에서 `Pause`, `Play`, `ArrowRightLeft` import 추가
    - `COMMAND_ICONS`에 `Hold: Pause`, `Retrieve: Play`, `BlindTransfer: ArrowRightLeft` 추가
    - BlindTransfer 인라인 표시 추가: `data.command === 'BlindTransfer' && data.targetUser`일 때 `To: {targetUser}@{targetHost}` 표시 (MakeCall의 targetUri 표시와 동일 패턴)

    **3. node-palette.tsx 팔레트 항목:**
    - Commands 섹션 (`<Section title="Commands">`)의 SendDTMF 항목 아래에 3개 팔레트 항목 추가:
      - `<PaletteItem type="command-Hold" label="Hold" icon={Pause} colorClass="bg-blue-50 border-blue-400 text-blue-900" />`
      - `<PaletteItem type="command-Retrieve" label="Retrieve" icon={Play} colorClass="bg-blue-50 border-blue-400 text-blue-900" />`
      - `<PaletteItem type="command-BlindTransfer" label="BlindTransfer" icon={ArrowRightLeft} colorClass="bg-blue-50 border-blue-400 text-blue-900" />`
    - 주의: Pause, Play, ArrowRightLeft는 이미 import되어 있으므로 새 import 불필요

    **4. command-properties.tsx BlindTransfer 분기:**
    - SendDTMF 분기 아래에 BlindTransfer 전용 분기 추가:
      - `data.command === 'BlindTransfer'` 조건
      - Target User Input (id="targetUser", value=data.targetUser, placeholder="carol")
      - Target Host Input (id="targetHost", value=data.targetHost, placeholder="192.168.1.100:5060")
      - 도움말 텍스트: "host:port (e.g. 192.168.1.100:5060)"
    - Hold/Retrieve는 파라미터가 없으므로 별도 분기 불필요 (기본 Label + SIP Instance만 표시)
    - 주의: CommandNodeData에 targetUser/targetHost를 이미 추가했으므로 `as any` 캐스팅 불필요

    **5. event-properties.tsx HELD/RETRIEVED/TRANSFERRED 타임아웃:**
    - DTMFReceived 분기 아래에 새 조건 분기 추가:
      - `(data.event === 'HELD' || data.event === 'RETRIEVED' || data.event === 'TRANSFERRED')` 조건
      - Timeout Input (id="timeout", type="number", value=data.timeout ?? 10000, min=1000, max=60000, step=1000)
      - 도움말 텍스트: "Maximum wait time for SIP event (default: 10000ms)"
    - DTMFReceived 타임아웃과 동일 패턴 사용 (Math.max(1000, Math.min(60000, val)))
  </action>
  <verify>
    1. `cd frontend && npx tsc --noEmit` — TypeScript 컴파일 에러 없음
    2. `cd frontend && npm run build` — 빌드 성공
  </verify>
  <done>
    - COMMAND_TYPES에 'Hold', 'Retrieve', 'BlindTransfer' 포함됨
    - CommandNodeData에 targetUser?, targetHost? 필드 존재
    - COMMAND_ICONS에 Hold, Retrieve, BlindTransfer 매핑됨
    - 팔레트에 command-Hold, command-Retrieve, command-BlindTransfer 항목 존재
    - BlindTransfer Properties에 targetUser, targetHost Input 존재
    - HELD/RETRIEVED/TRANSFERRED 이벤트에 Timeout Input 존재
    - TypeScript 빌드 성공
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>6개 새 노드의 완전한 UI — 팔레트 항목, 아이콘, Properties 패널, 캔버스 인라인 표시</what-built>
  <how-to-verify>
    1. `wails dev`로 앱 실행
    2. 노드 팔레트 확인: Commands 섹션에 Hold(Pause 아이콘), Retrieve(Play 아이콘), BlindTransfer(ArrowRightLeft 아이콘) 표시되는지 확인
    3. 드래그앤드롭 테스트:
       - Hold를 캔버스로 드래그 — 파란색 Command 노드로 생성, Pause 아이콘 표시
       - Retrieve를 캔버스로 드래그 — 파란색 Command 노드, Play 아이콘
       - BlindTransfer를 캔버스로 드래그 — 파란색 Command 노드, ArrowRightLeft 아이콘
    4. Properties 패널 확인:
       - Hold 노드 클릭 — Command Type: Hold 배지, Label, SIP Instance 선택만 표시 (추가 파라미터 없음)
       - Retrieve 노드 클릭 — 동일 (파라미터 없음)
       - BlindTransfer 노드 클릭 — Target User, Target Host 입력 필드 추가 표시
       - BlindTransfer에 targetUser="carol", targetHost="192.168.1.100:5060" 입력 후 캔버스에서 "To: carol@192.168.1.100:5060" 인라인 표시 확인
    5. Events 섹션의 HELD/RETRIEVED/TRANSFERRED 노드를 캔버스로 드래그:
       - 각 이벤트 노드 클릭 시 Timeout 입력 필드가 표시되는지 확인 (기본값 10000ms)
    6. 기존 노드(MakeCall, Answer, Release, PlayAudio, SendDTMF) 동작이 변하지 않았는지 확인
  </how-to-verify>
  <resume-signal>"approved"를 입력하거나 발견된 문제를 설명하세요</resume-signal>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` — 전체 TypeScript 타입 체크 통과
2. `cd frontend && npm run build` — 프로덕션 빌드 성공
3. 6개 새 노드가 팔레트에 표시되고 캔버스 DnD 동작 확인 (사용자 검증)
</verification>

<success_criteria>
- UI-03 충족: 6개 새 노드에 Properties 패널, 아이콘, 팔레트 항목이 완전하게 추가됨
- NF-03 충족: 새 노드의 DnD 동작이 기존 MakeCall, Answer, Release와 동일한 UX 패턴
- TypeScript 빌드 에러 없음
- 사용자 시각적 검증 통과
</success_criteria>

<output>
완료 후, `.planning/phases/13-new-node-ui-integration-quality/13-01-SUMMARY.md` 생성
</output>
