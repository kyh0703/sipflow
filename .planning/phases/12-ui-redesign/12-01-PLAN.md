---
phase: 12-ui-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/ui/resizable.tsx
  - frontend/src/features/scenario-builder/components/activity-bar.tsx
  - frontend/src/features/scenario-builder/components/scenario-builder.tsx
autonomous: true

must_haves:
  truths:
    - "Activity Bar(w-12, 48px)가 좌측에 고정 표시되고, ScenarioTree(FolderTree)/NodePalette(Puzzle) 아이콘이 상단에, Settings(비활성)+ThemeToggle이 하단에 배치된다"
    - "Activity Bar 아이콘 클릭 시 해당 패널이 사이드바에 표시되고, 동일 아이콘 재클릭 시 사이드바가 collapse된다"
    - "다른 아이콘 클릭 시 사이드바가 닫히지 않고 패널만 즉시 교체된다"
    - "좌측 사이드바와 우측 Properties 패널이 shadcn ResizablePanel로 너비 조절 가능하다 (minSize/maxSize 제약 적용)"
    - "앱 시작 시 ScenarioTree 패널이 기본으로 열려 있다"
    - "ThemeToggle이 헤더에서 제거되고 Activity Bar 하단에 배치된다"
    - "기존 ScenarioTree, NodePalette, PropertiesPanel, Canvas 컴포넌트가 변경 없이 동작한다"
  artifacts:
    - path: "frontend/src/components/ui/resizable.tsx"
      provides: "shadcn ResizablePanelGroup, ResizablePanel, ResizableHandle 래퍼 컴포넌트"
      contains: "ResizablePanelGroup"
    - path: "frontend/src/features/scenario-builder/components/activity-bar.tsx"
      provides: "ActivityBar 컴포넌트 (FolderTree, Puzzle, Settings 아이콘 + ThemeToggle)"
      contains: "ActivityBar"
    - path: "frontend/src/features/scenario-builder/components/scenario-builder.tsx"
      provides: "ResizablePanelGroup 기반 레이아웃, activePanel 상태, sidebarRef 토글, ThemeToggle 제거"
      contains: "ResizablePanelGroup"
  key_links:
    - from: "scenario-builder.tsx ActivityBar"
      to: "activity-bar.tsx ActivityBar"
      via: "import { ActivityBar } from './activity-bar'"
      pattern: "ActivityBar"
    - from: "scenario-builder.tsx ResizablePanelGroup"
      to: "resizable.tsx"
      via: "import { ResizablePanelGroup, ResizablePanel, ResizableHandle } from '@/components/ui/resizable'"
      pattern: "ResizablePanelGroup"
    - from: "scenario-builder.tsx handlePanelToggle"
      to: "react-resizable-panels ImperativePanelHandle"
      via: "sidebarRef.current?.collapse() / expand()"
      pattern: "sidebarRef"
    - from: "activity-bar.tsx ThemeToggle"
      to: "components/ui/theme-toggle.tsx"
      via: "import { ThemeToggle } from '@/components/ui/theme-toggle'"
      pattern: "ThemeToggle"
    - from: "scenario-builder.tsx onCollapse"
      to: "scenario-builder.tsx setActivePanel"
      via: "onCollapse={() => setActivePanel(null)}"
      pattern: "onCollapse"
---

<objective>
shadcn Resizable 컴포넌트를 설치하고, Activity Bar 컴포넌트를 생성하고, ScenarioBuilder 레이아웃을 ResizablePanelGroup 기반으로 재구성한다.

Purpose: UI-01(Activity Bar 토글) + UI-02(Resizable 사이드바) 요구사항을 모두 충족한다. 사용자가 Activity Bar 아이콘 클릭으로 ScenarioTree/NodePalette 패널을 전환하고, 사이드바와 Properties 패널의 너비를 자유롭게 조절할 수 있다.
Output: resizable.tsx(shadcn 생성), activity-bar.tsx(신규), scenario-builder.tsx(재구성), ThemeToggle 이동 완료, 프론트엔드 빌드 성공
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12-ui-redesign/12-RESEARCH.md
@.planning/phases/12-ui-redesign/CONTEXT.md
@frontend/src/features/scenario-builder/components/scenario-builder.tsx
@frontend/src/components/ui/theme-toggle.tsx
@frontend/components.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: shadcn Resizable 컴포넌트 설치</name>
  <files>
    frontend/src/components/ui/resizable.tsx
  </files>
  <action>
**shadcn CLI로 resizable 컴포넌트 생성:**

프론트엔드 디렉토리에서 실행:
```bash
cd /Users/kyh0703/Project/sipflow/frontend && npx shadcn@latest add resizable
```

이 명령은 `frontend/src/components/ui/resizable.tsx`를 생성한다.
`react-resizable-panels` v4.6.4가 이미 node_modules에 설치되어 있으므로 npm install은 불필요.

**생성 후 확인:**
- resizable.tsx에서 `ResizablePanelGroup`, `ResizablePanel`, `ResizableHandle`이 export되는지 확인
- `orientation` prop이 사용되는지 확인 (v4 API — `direction`은 v3 구버전)
  </action>
  <verify>
파일 존재: `ls frontend/src/components/ui/resizable.tsx` -- 존재.
export 확인: `grep -n "ResizablePanelGroup\|ResizablePanel\|ResizableHandle" frontend/src/components/ui/resizable.tsx` -- 세 개 모두 export됨.
빌드 확인: `cd /Users/kyh0703/Project/sipflow/frontend && npm run build` -- 컴파일 성공 (기존 코드에 영향 없음).
  </verify>
  <done>
shadcn resizable.tsx가 생성되어 ResizablePanelGroup, ResizablePanel, ResizableHandle을 export한다. 기존 프론트엔드 빌드가 깨지지 않는다.
  </done>
</task>

<task type="auto">
  <name>Task 2: ActivityBar 컴포넌트 생성</name>
  <files>
    frontend/src/features/scenario-builder/components/activity-bar.tsx
  </files>
  <action>
**activity-bar.tsx 신규 파일 생성:**

12-RESEARCH.md 예시 2 (ActivityBar 컴포넌트 완전한 구현)를 기반으로 한다.

**컴포넌트 구조:**

```tsx
// activity-bar.tsx
import { FolderTree, Puzzle, Settings } from 'lucide-react'
import { ThemeToggle } from '@/components/ui/theme-toggle'
import { cn } from '@/lib/utils'
```

**ActivityIconProps 인터페이스:**
```tsx
interface ActivityIconProps {
  icon: React.ComponentType<{ className?: string }>
  isActive: boolean
  onClick: () => void
  title: string
  disabled?: boolean
}
```

**ActivityIcon 내부 컴포넌트:**
- `cn()`으로 클래스 합성
- 활성 상태: `text-foreground` + 좌측 2px 인디케이터 (`absolute left-0 top-2 bottom-2 w-0.5 bg-primary rounded-r`)
- 비활성 상태: `text-muted-foreground hover:text-foreground`
- disabled: `opacity-40 cursor-not-allowed`
- 아이콘 크기: `w-5 h-5` (20px, lucide 기본 24px보다 약간 작게)

**ActivityBarProps 인터페이스:**
```tsx
interface ActivityBarProps {
  activePanel: 'scenario' | 'palette' | null
  onPanelToggle: (panel: 'scenario' | 'palette') => void
}
```

**ActivityBar 컴포넌트:**
- 루트: `div className="w-12 border-r border-border bg-muted flex flex-col items-center py-2 shrink-0"`
- 상단 영역 (`flex flex-col items-center gap-1`):
  - `FolderTree` 아이콘 — ScenarioTree (RESEARCH 함정 1: FileTree는 존재하지 않으므로 FolderTree 사용)
  - `Puzzle` 아이콘 — NodePalette
- 중간 스페이서: `div className="flex-1"`
- 하단 영역 (`flex flex-col items-center gap-1`):
  - `Settings` 아이콘 — disabled (현재 기능 없음, CONTEXT.md 결정)
  - `ThemeToggle` 컴포넌트 — 헤더에서 이동 (컴포넌트 변경 없이 재사용)

**핵심:** ActivityBar는 순수 프레젠테이션 컴포넌트. 상태는 부모(ScenarioBuilder)에서 관리.
  </action>
  <verify>
파일 존재: `ls frontend/src/features/scenario-builder/components/activity-bar.tsx` -- 존재.
export 확인: `grep -n "export function ActivityBar" frontend/src/features/scenario-builder/components/activity-bar.tsx` -- export 존재.
아이콘 확인: `grep -n "FolderTree\|Puzzle\|Settings" frontend/src/features/scenario-builder/components/activity-bar.tsx` -- 세 아이콘 모두 import됨.
ThemeToggle 확인: `grep -n "ThemeToggle" frontend/src/features/scenario-builder/components/activity-bar.tsx` -- import 및 사용.
빌드 확인: `cd /Users/kyh0703/Project/sipflow/frontend && npm run build` -- 컴파일 성공.
  </verify>
  <done>
ActivityBar 컴포넌트가 생성된다. 상단에 FolderTree(ScenarioTree), Puzzle(NodePalette) 아이콘, 하단에 Settings(비활성), ThemeToggle이 배치된다. 활성 아이콘에 좌측 2px primary 인디케이터가 표시된다. 프론트엔드 빌드가 성공한다.
  </done>
</task>

<task type="auto">
  <name>Task 3: ScenarioBuilder 레이아웃 재구성 — ResizablePanelGroup + ActivityBar 통합</name>
  <files>
    frontend/src/features/scenario-builder/components/scenario-builder.tsx
  </files>
  <action>
**scenario-builder.tsx 전면 재구성:**

12-RESEARCH.md 예시 1 (수정된 ScenarioBuilder)을 기반으로 한다.

**1. import 변경:**
- 추가:
  ```tsx
  import { useRef } from 'react'
  import type { ImperativePanelHandle } from 'react-resizable-panels'
  import { ResizablePanelGroup, ResizablePanel, ResizableHandle } from '@/components/ui/resizable'
  import { ActivityBar } from './activity-bar'
  ```
- 제거:
  ```tsx
  import { ThemeToggle } from '@/components/ui/theme-toggle'
  ```
- lucide-react import에서 ThemeToggle 전용 아이콘은 이미 ThemeToggle 내부에서 import하므로 변경 불필요

**2. 컴포넌트 내부 state 추가:**
```tsx
const [activePanel, setActivePanel] = useState<'scenario' | 'palette' | null>('scenario')
const sidebarRef = useRef<ImperativePanelHandle>(null)
```

기본값 `'scenario'`는 CONTEXT.md 결정: "앱 시작 시 ScenarioTree 패널이 기본으로 열림".

**3. handlePanelToggle 함수 추가:**
```tsx
const handlePanelToggle = (panel: 'scenario' | 'palette') => {
  if (activePanel === panel && !sidebarRef.current?.isCollapsed()) {
    sidebarRef.current?.collapse()
    setActivePanel(null)
  } else {
    sidebarRef.current?.expand()
    setActivePanel(panel)
  }
}
```
- 동일 아이콘 재클릭 → collapse + activePanel null
- 다른 아이콘 클릭 → expand (이미 열려 있으면 무시) + activePanel 변경
- 닫힌 상태에서 아이콘 클릭 → expand + activePanel 설정

**4. 헤더 변경:**
- `<ThemeToggle />` 제거 (Activity Bar 하단으로 이동됨)
- 나머지 헤더 요소(시나리오명, 저장상태, ExecutionToolbar, Save버튼) 유지

**5. Main content 영역 재구성:**

기존:
```tsx
<div className="flex flex-1 overflow-hidden">
  <div className="w-[200px] border-r border-border flex flex-col bg-background">
    <ScenarioTree /> + <NodePalette />
  </div>
  <div className="flex-1 flex flex-col">
    <Canvas /> + 실행 패널
  </div>
  <div className="w-[280px] border-l border-border bg-background overflow-y-auto p-4">
    <PropertiesPanel />
  </div>
</div>
```

변경 후:
```tsx
<div className="flex flex-1 overflow-hidden">
  {/* Activity Bar (고정 48px, ResizablePanel 아님) */}
  <ActivityBar
    activePanel={activePanel}
    onPanelToggle={handlePanelToggle}
  />

  {/* Resizable layout */}
  <ResizablePanelGroup orientation="horizontal" className="flex-1">
    {/* 좌측 사이드바 */}
    <ResizablePanel
      defaultSize={17}
      minSize={15}
      maxSize={30}
      collapsible
      collapsedSize={0}
      ref={sidebarRef}
      onCollapse={() => setActivePanel(null)}
    >
      <div className="h-full overflow-y-auto">
        {activePanel === 'scenario' && <ScenarioTree />}
        {activePanel === 'palette' && (
          <div className="p-3">
            <NodePalette />
          </div>
        )}
      </div>
    </ResizablePanel>

    <ResizableHandle withHandle />

    {/* 캔버스 */}
    <ResizablePanel defaultSize={61}>
      <div className="flex-1 flex flex-col h-full">
        <div className="flex-1">
          <Canvas />
        </div>
        {/* 실행 패널 (기존 bottomTab 로직 동일) */}
        {executionStatus !== 'idle' && (
          <div className="border-t border-border bg-background">
            {/* 기존 탭 헤더 + 탭 컨텐츠 그대로 유지 */}
          </div>
        )}
      </div>
    </ResizablePanel>

    <ResizableHandle withHandle />

    {/* 우측 Properties */}
    <ResizablePanel
      defaultSize={22}
      minSize={15}
      maxSize={30}
    >
      <div className="h-full overflow-y-auto p-4">
        <PropertiesPanel />
      </div>
    </ResizablePanel>
  </ResizablePanelGroup>
</div>
```

**defaultSize 합계:** 17 + 61 + 22 = 100 (정확히 100%)

**주의사항 (RESEARCH 함정):**
- 함정 2: `collapsible` Panel에서 드래그로 minSize 이하가 되면 자동 collapse → `onCollapse` 콜백으로 `setActivePanel(null)` 동기화
- 함정 3: ResizablePanelGroup은 내부적으로 `display: flex` 사용 → Panel 내부에 `h-full overflow-y-auto` 적용
- 함정 5: ReactFlow는 ResizeObserver로 자동 적응 → 별도 처리 불필요
- 함정 6: v4에서 `direction` → `orientation` 변경됨 → `orientation="horizontal"` 사용

**6. `ref` vs `panelRef` 확인:**
shadcn resizable.tsx가 생성된 후 ResizablePanel이 `ref`를 직접 받는지 `panelRef`를 별도로 받는지 확인 필요.
- shadcn 래퍼가 `React.forwardRef`로 구현되면 `ref={sidebarRef}` 사용
- 래퍼 없이 직접 export면 `ref={sidebarRef}` 사용 (react-resizable-panels v4는 ref를 직접 지원)
- 설치 후 생성된 resizable.tsx의 실제 구현을 확인하고 적절히 조정
  </action>
  <verify>
빌드 확인: `cd /Users/kyh0703/Project/sipflow/frontend && npm run build` -- 컴파일 성공.
import 확인:
- `grep -n "ResizablePanelGroup" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- import 및 사용
- `grep -n "ActivityBar" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- import 및 사용
- `grep -n "ThemeToggle" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- 제거됨 (없어야 함)
레이아웃 확인:
- `grep -n "activePanel" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- state 및 토글 로직
- `grep -n "sidebarRef" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- ref 및 collapse/expand 사용
- `grep -n "collapsible" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- 좌측 Panel에 collapsible 적용
- `grep -n "onCollapse" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- activePanel null 동기화
- `grep -n "handlePanelToggle" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- 토글 함수 존재
defaultSize 합계: `grep -n "defaultSize" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- 17 + 61 + 22 = 100
  </verify>
  <done>
ScenarioBuilder가 Activity Bar(48px 고정) + ResizablePanelGroup(좌측 사이드바 + 캔버스 + 우측 Properties) 레이아웃으로 재구성된다. Activity Bar 아이콘 클릭으로 ScenarioTree/NodePalette를 토글/전환한다. 좌측 사이드바는 collapsible이며 드래그 collapse 시 activePanel이 null로 동기화된다. 우측 Properties는 Resizable로 너비 조절 가능하다. ThemeToggle이 헤더에서 제거된다. defaultSize 합계가 100%이다. 프론트엔드 빌드가 성공한다.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/kyh0703/Project/sipflow/frontend && npm run build` -- 프론트엔드 빌드 성공
2. 파일 존재 확인:
   - `ls frontend/src/components/ui/resizable.tsx` -- shadcn 생성 파일 존재
   - `ls frontend/src/features/scenario-builder/components/activity-bar.tsx` -- 신규 파일 존재
3. 핵심 연결 확인:
   - `grep -n "ResizablePanelGroup" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- 레이아웃 적용
   - `grep -n "ActivityBar" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- ActivityBar 통합
   - `grep -rn "ThemeToggle" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- 제거됨 (0 results)
   - `grep -n "ThemeToggle" frontend/src/features/scenario-builder/components/activity-bar.tsx` -- Activity Bar에서 사용
   - `grep -n "FolderTree" frontend/src/features/scenario-builder/components/activity-bar.tsx` -- ScenarioTree 아이콘
   - `grep -n "Puzzle" frontend/src/features/scenario-builder/components/activity-bar.tsx` -- NodePalette 아이콘
   - `grep -n "collapsible" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- 사이드바 collapse 지원
   - `grep -n "onCollapse" frontend/src/features/scenario-builder/components/scenario-builder.tsx` -- 드래그 collapse 동기화
4. 기존 컴포넌트 미변경 확인:
   - ScenarioTree, NodePalette, PropertiesPanel, Canvas, ThemeToggle 파일 자체는 변경 없음
</verification>

<success_criteria>
- UI-01: Activity Bar(48px)에 ScenarioTree/NodePalette 아이콘이 표시되고 클릭 시 해당 패널이 토글/전환된다
- UI-01: 동일 아이콘 재클릭 시 사이드바가 닫혀 캔버스가 전체 너비를 사용한다
- UI-01: 다른 아이콘 클릭 시 사이드바가 닫히지 않고 패널만 즉시 교체된다
- UI-02: 좌측 사이드바와 우측 Properties 패널이 shadcn ResizablePanel로 드래그 너비 조절이 가능하다
- UI-02: minSize/maxSize 제약으로 패널이 과도하게 축소/확대되지 않는다
- 기본 상태: 앱 시작 시 ScenarioTree 패널이 열려 있다
- ThemeToggle: 헤더에서 제거되고 Activity Bar 하단에서 동작한다
- 회귀 없음: ScenarioTree, NodePalette, PropertiesPanel, Canvas 기능이 동일하게 동작한다
- 빌드 성공: 프론트엔드 빌드 에러 없음
</success_criteria>

<output>
완료 후, `.planning/phases/12-ui-redesign/12-01-SUMMARY.md` 생성
</output>
